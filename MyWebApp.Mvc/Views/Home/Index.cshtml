@using System.Linq
@model List<MyWebApp.Models.MusicFile>
@{
    ViewData["Title"] = "Trang chủ";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SoundAudio</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/MyWebApp.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
</head>
<body>
<script>
    const imageBox = document.getElementById("imageBox");
    const nextBtn = document.getElementById("nextBtn");
    const prevBtn = document.getElementById("prevBtn");

    nextBtn.addEventListener("click", () => {
        imageBox.scrollLeft += 320; // 300px card + 20px gap
    });

    prevBtn.addEventListener("click", () => {
        imageBox.scrollLeft -= 320;
  });
</script>

  @if (ViewBag.ViewMode == null)
{
<div class="content">
  <!-- Hàng ảnh cuộn ngang -->
  <div class="image-box" id="imageBox">
    <div class="image-row">
      <div class="card">
        <div class="image">
          <img src="https://kenh14cdn.com/203336854389633024/2024/10/2/image2-1630-1727833092698-17278330935461724047371.jpg" />
        </div>
        <div class="details">
            <h1>HIEUTHUHAI</h1>
            <p>HIEUTHUHAI là một rapper nổi tiếng với những bản rap chất lượng và phong cách độc đáo.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://yt3.googleusercontent.com/c-Z7mIlntSpG6VyQ5ZqaPggqkZRhaySr-H5ZEazFN2iR1pP4eD1UGekwu0y--c4CSVhJJ1A4QT8=s160-c-k-c0x00ffffff-no-rj" />
        </div>
        <div class="details">
            <h1>Sơn Tùng MTP</h1>
            <p>Sơn Tùng M-TP là một trong những nghệ sĩ nổi tiếng nhất Việt Nam, với nhiều bản hit đình đám.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://i1-giaitri.vnecdn.net/2023/05/11/BRAY-232-jpeg-3783-1683791747.jpg?w=0&h=0&q=100&dpr=2&fit=crop&s=zPP0-OF54PewoHSoti44kA" />
        </div>
        <div class="details">
            <h1>Bray</h1>
            <p>Bray là một rapper trẻ tuổi, nổi bật với những ca khúc mang âm hưởng hiện đại và phong cách cá tính.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://i.scdn.co/image/ab6761610000e5eb653268b19c265e835504190e" />
        </div>
        <div class="details">
            <h1>Anh Tú</h1>
            <p>Anh Tú hay còn biết đến với biệt danh "Voi bản đôn" là một nghệ sĩ đa tài, không chỉ là rapper mà còn là ca sĩ và nhạc sĩ, với nhiều bản hit được yêu thích.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://showbizvietnam.vn/wp-content/uploads/2024/04/MCK_2.jpg" />
        </div>
        <div class="details">
            <h1>MCK</h1>
            <p>MCK là một rapper trẻ, nổi bật với những ca khúc mang âm hưởng hiện đại và phong cách cá tính.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://nld.mediacdn.vn/291774122806476800/2024/12/3/img-2603-6781-17332168023391243238442.jpg" />
        </div>
        <div class="details">
            <h1>Quang Hùng MasterD</h1>
            <p>Quang Hùng MasterD là một nghệ sĩ trẻ nổi bật trong làng nhạc Việt và Thái Lan, với những bản rap mang âm hưởng hiện đại và phong cách cá tính.</p>
        </div>
        </div>
      <!-- Thêm bao nhiêu card tùy bạn -->
    </div>
  </div>
</div>
}
  <div class="index-container">
    @for (int i = 0; i < Model.Count; i++)
    {
        var song = Model[i];
        // Build full absolute URL cho FilePath và ImageUrl
        var baseUrl = $"{Context.Request.Scheme}://{Context.Request.Host}";
        var musicUrl = $"{baseUrl}{song.FilePath}";
        var imageUrl = string.IsNullOrEmpty(song.ImageUrl) 
            ? "/images/default-music.jpg" 
            : $"{baseUrl}{song.ImageUrl}";

        <div class="col">
            <div class="card h-100 shadow-sm song-card" data-src="@musicUrl">
                <img src="@imageUrl" class="card-img-top" alt="Ảnh bài hát" />
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title" style="color: white">@song.NameSong</h5>
                    <button class="btn btn-outline-success mt-auto add-to-playlist" data-song-id="@song.Id">
                        <i class="fas fa-plus"></i> Thêm vào Playlist
                    </button>
                </div>
            </div>
        </div>
    }
    else if (ViewBag.ViewMode == "Search")
    {
        <h2 class="NameList">Kết quả tìm kiếm</h2>
        @if (ViewBag.SearchResults != null && ((IEnumerable<dynamic>)ViewBag.SearchResults).Any())
        {
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                @foreach (var song in ViewBag.SearchResults)
                {
                    <div class="col">
                        <div class="card h-100 shadow-sm song-card">
                            <img src="@song.ImageUrl ?? "/images/default-music.jpg"" class="card-img-top" alt="Ảnh bài hát" />
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">@song.NameSong</h5>
                                <button class="btn btn-sm btn-primary mt-auto add-to-playlist" data-song-id="@song.Id">
                                    <i class="fas fa-plus"></i> Thêm vào Playlist
                                </button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <p>Không tìm thấy bài hát nào.</p>
        }
    }
</div>

    
    <!-- Navbar fixed-top -->
<nav class="navbar navbar-dark bg-dark fixed-top">
  <div class="container-fluid d-flex align-items-center">
    <!-- Nút toggle nằm bên trái -->
    <div class="d-flex align-items-center">
      <button class="navbar-toggler me-2" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand m-0" href="#">SoundAudio</a>
    </div>

    <!-- Tìm kiếm đặt bên phải navbar -->
    <form asp-controller="Home" asp-action="Search" method="get"
      class="boxsearch position-absolute top-50 start-50 translate-middle d-flex align-items-center">
      <input type="text" name="query" placeholder="Tìm bài hát..." />
      <button type="submit">Tìm Kiếm</button>
    </form>

  <!-- Offcanvas Sidebar -->
  <div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar"
    aria-labelledby="offcanvasDarkNavbarLabel">
    <div class="offcanvas-header">
      <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">
        <img src="/images/logo.png" alt="SoundAudio"> SoundAudio
      </a>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">Bạn</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Danh sách phát</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Thông báo</a>
        </li>
      </ul>
      <div class="login-box">
        <p>Đăng nhập để trải nghiệm playlist riêng của bạn</p>
        <a href="/Home/DangNhap" class="login-button">Đăng nhập</a>
      </div>
    </div>
  </div>
</nav>
  <style>
  .navbar.bg-dark {
    background-color: #000 !important;
  }

  .offcanvas-body {
    font-size: 2.2rem !important;
    background-color: #222 !important;
  }

  .offcanvas-header {
    background-color: #222 !important;
  }
</style>

    <div class="right-section">
        <a href="/Home/DangKy" class="register-link">Đăng ký</a>
        <a href="/Home/DangNhap" class="login-button">Đăng nhập</a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="https://unpkg.com/wavesurfer.js@7"></script>

  <style>
    .waveform {
    width: 100%;
    margin-top: 5px;
    }

    .song-details {
    display: flex;
    flex-direction: column;
    }
  </style>

</body>
</html>