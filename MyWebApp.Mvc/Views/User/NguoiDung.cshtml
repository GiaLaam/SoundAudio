@model List<MyWebApp.Models.MusicFile>
@{
    ViewData["Title"] = "Ng∆∞·ªùi D√πng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SoundAudio</title>
<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="~/MyWebApp.styles.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/Profile.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/Playlist.css" asp-append-version="true" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<body>
    <header>
        <nav class="navbar navbar-dark bg-dark fixed-top">
            <div class="container-fluid d-flex align-items-center">
                <!-- N√∫t toggle n·∫±m b√™n tr√°i -->
                <div class="d-flex align-items-center">
                    <button class="navbar-toggler me-2" type="button" data-bs-toggle="offcanvas"
                            data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <a class="navbar-brand m-0" href="/User/NguoiDung">SoundAudio</a>
                </div>

                <!-- T√¨m ki·∫øm ƒë·∫∑t b√™n ph·∫£i navbar -->
                <form asp-controller="Home" asp-action="Search" method="get"
                      class="boxsearch position-absolute top-50 start-50 translate-middle d-flex align-items-center">
                    <input type="text" name="query" placeholder="T√¨m b√†i h√°t..." />
                    <button type="submit">T√¨m Ki·∫øm</button>
                </form>

                <!-- Offcanvas Sidebar -->
                <div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar"
                     aria-labelledby="offcanvasDarkNavbarLabel">
                    <div class="offcanvas-header">
                        <a class="navbar-brand" href="/User/NguoiDung">
                            <img src="/images/logo.png" alt="SoundAudio"> SoundAudio
                        </a>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="/User/Profile">B·∫°n</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/User/Playlist">Danh s√°ch ph√°t</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Th√¥ng b√°o</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/Home/DangXuat">ƒêƒÉng xu·∫•t</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
        <style>
            .navbar.bg-dark {
                background-color: #000 !important;
            }

            .offcanvas-body {
                font-size: 2rem !important;
                background-color: #222 !important;
            }

            .offcanvas-header {
                background-color: #222 !important;
            }
        </style>
    </header>

@if (ViewBag.ViewMode == "Default")
{
<div class="content image-box-wrapper">
  <!-- H√†ng ·∫£nh cu·ªôn ngang -->
  <div class="image-box" id="imageBox">
    <div class="image-row">
      <div class="card">
        <div class="image">
          <img src="https://kenh14cdn.com/203336854389633024/2024/10/2/image2-1630-1727833092698-17278330935461724047371.jpg" />
        </div>
        <div class="details">
            <h1>HIEUTHUHAI</h1>
            <p>Tr·∫ßn Minh Hi·∫øu (sinh ng√†y 28 th√°ng 9 nƒÉm 1999), th∆∞·ªùng ƒë∆∞·ª£c bi·∫øt ƒë·∫øn v·ªõi ngh·ªá danh Hieuthuhai (vi·∫øt c√°ch ƒëi·ªáu l√† HIEUTHUHAI ho·∫∑c hieuthuhai), l√† m·ªôt nam rapper v√† ca sƒ© ki√™m s√°ng t√°c nh·∫°c ng∆∞·ªùi Vi·ªát Nam.
                Anh l√† th√†nh vi√™n c·ªßa t·ªï ƒë·ªôi Gerdnang.
                Anh b·∫Øt ƒë·∫ßu tr·ªü n√™n n·ªïi ti·∫øng sau khi tham gia ch∆∞∆°ng tr√¨nh Th·∫ø gi·ªõi Rap ‚Äì King of Rap m√πa ƒë·∫ßu ti√™n. 
                Ngo√†i ra, anh c≈©ng l√† th√†nh vi√™n ch√≠nh trong ch∆∞∆°ng tr√¨nh truy·ªÅn h√¨nh th·ª±c t·∫ø 2 ng√†y 1 ƒë√™m. 
            </p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://yt3.googleusercontent.com/c-Z7mIlntSpG6VyQ5ZqaPggqkZRhaySr-H5ZEazFN2iR1pP4eD1UGekwu0y--c4CSVhJJ1A4QT8=s160-c-k-c0x00ffffff-no-rj" />
        </div>
        <div class="details">
            <h1>S∆°n T√πng MTP</h1>
            <p>S∆°n T√πng M-TP l√† m·ªôt trong nh·ªØng ngh·ªá sƒ© n·ªïi ti·∫øng nh·∫•t Vi·ªát Nam, v·ªõi nhi·ªÅu b·∫£n hit ƒë√¨nh ƒë√°m.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://i1-giaitri.vnecdn.net/2023/05/11/BRAY-232-jpeg-3783-1683791747.jpg?w=0&h=0&q=100&dpr=2&fit=crop&s=zPP0-OF54PewoHSoti44kA" />
        </div>
        <div class="details">
            <h1>Bray</h1>
            <p>Bray l√† m·ªôt rapper tr·∫ª tu·ªïi, n·ªïi b·∫≠t v·ªõi nh·ªØng ca kh√∫c mang √¢m h∆∞·ªüng hi·ªán ƒë·∫°i v√† phong c√°ch c√° t√≠nh.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://i.scdn.co/image/ab6761610000e5eb653268b19c265e835504190e" />
        </div>
        <div class="details">
            <h1>Anh T√∫</h1>
            <p>Anh T√∫ hay c√≤n bi·∫øt ƒë·∫øn v·ªõi bi·ªát danh "Voi b·∫£n ƒë√¥n" l√† m·ªôt ngh·ªá sƒ© ƒëa t√†i, kh√¥ng ch·ªâ l√† rapper m√† c√≤n l√† ca sƒ© v√† nh·∫°c sƒ©, v·ªõi nhi·ªÅu b·∫£n hit ƒë∆∞·ª£c y√™u th√≠ch.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://showbizvietnam.vn/wp-content/uploads/2024/04/MCK_2.jpg" />
        </div>
        <div class="details">
            <h1>MCK</h1>
            <p>MCK l√† m·ªôt rapper tr·∫ª, n·ªïi b·∫≠t v·ªõi nh·ªØng ca kh√∫c mang √¢m h∆∞·ªüng hi·ªán ƒë·∫°i v√† phong c√°ch c√° t√≠nh.</p>
        </div>
      </div>
      <div class="card">
        <div class="image">
          <img src="https://nld.mediacdn.vn/291774122806476800/2024/12/3/img-2603-6781-17332168023391243238442.jpg" />
        </div>
        <div class="details">
            <h1>Quang H√πng MasterD</h1>
            <p>Quang H√πng MasterD l√† m·ªôt ngh·ªá sƒ© tr·∫ª n·ªïi b·∫≠t trong l√†ng nh·∫°c Vi·ªát v√† Th√°i Lan, v·ªõi nh·ªØng b·∫£n rap mang √¢m h∆∞·ªüng hi·ªán ƒë·∫°i v√† phong c√°ch c√° t√≠nh.</p>
        </div>
      </div>
      <!-- Th√™m bao nhi√™u card t√πy b·∫°n -->
    </div>
  </div>
</div>
}

    <div class="index-container">
    @if (ViewBag.ViewMode == "Default")
    {
        <h2 class="NameList">Danh S√°ch Nh·∫°c</h2>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
            @for (int i = 0; i < Model.Count; i++)
            {
                var song = Model[i];
                <div class="col">
                    <div class="card h-100 shadow-sm song-card" data-src="@song.FilePath">
                        <img src="@(song.ImageUrl ?? "/images/default-music.jpg")" class="card-img-top" alt="·∫¢nh b√†i h√°t" />
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title" style="color: white">@song.NameSong</h5>
                            <button class="btn btn-outline-success mt-auto add-to-playlist" data-song-id="@song.Id">
                                <i class="fas fa-plus"></i> Th√™m v√†o Playlist
                            </button>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else if (ViewBag.ViewMode == "Search")
    {
        <h2 class="NameList">K·∫øt qu·∫£ t√¨m ki·∫øm</h2>
        @if (ViewBag.SearchResults != null && ((IEnumerable<dynamic>)ViewBag.SearchResults).Any())
        {
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                @foreach (var song in ViewBag.SearchResults)
                {
                    <div class="col">
                        <div class="card h-100 shadow-sm song-card">
                            <img src="@(song.ImageUrl ?? "/images/default-music.jpg")" class="card-img-top" alt="·∫¢nh b√†i h√°t" />
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title" style="color: white;">@song.NameSong</h5>
                                <button class="btn btn-outline-success mt-auto add-to-playlist" data-song-id="@song.Id">
                                    <i class="fas fa-plus"></i> Th√™m v√†o Playlist
                                </button>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <p>Kh√¥ng t√¨m th·∫•y b√†i h√°t n√†o.</p>
        }
    }
        else if (ViewBag.ViewMode == "Playlist")
        {
            <div class="playlist-container">
                <h2 class="NameList">Danh S√°ch Ph√°t C·ªßa B·∫°n</h2>
                @if (ViewBag.Playlists != null && ViewBag.Playlists.Count > 0)
                {
                    <div class="playlist-grid">
                        @foreach (var playlist in ViewBag.Playlists)
                        {
                            <div class="playlist-card" data-id="@playlist.Id" data-name="@playlist.Name">
                                <div class="playlist-icon">
                                    <i class="fas fa-heart"></i>
                                </div>
                                <div class="playlist-info">
                                    <h3 class="playlist-title">@playlist.Name</h3>
                                    <p class="playlist-count">@playlist.MusicIds?.Count b√†i h√°t</p>

                                    <div class="playlist-actions">
                                        <button class="btn btn-sm btn-primary btn-play">Ph√°t</button>
                                        <button class="btn btn-sm btn-secondary btn-view">Xem</button>
                                        <button class="btn btn-sm btn-outline-light btn-edit" data-id="@playlist.Id" data-name="@playlist.Name">S·ª≠a</button>
                                        <button class="btn btn-sm btn-danger btn-delete-playlist" data-id="@playlist.Id">Xo√°</button>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p>B·∫°n ch∆∞a c√≥ danh s√°ch ph√°t n√†o. H√£y t·∫°o m·ªôt danh s√°ch m·ªõi!</p>
                }
            </div>
        }
        else if (ViewBag.ViewMode == "Profile")
        {
            <div class="container1" style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #222;">
                <div style="text-align: center; max-width: 500px; width: 100%; background-color: #222;">
                    <img src="/images/logo.png" alt="SoundAudio" style="width: 200px; height: auto; margin-bottom: 20px;">
                    <h2 style="color: white; font-size: 50px; margin-bottom: 20px;">Th√¥ng tin c√° nh√¢n</h2>
                    <form id="profileForm">
                    <input type="hidden" name="userId" value="@(ViewBag.UserData?.Id ?? "")" />
                            <div class="TextBox">
                                <p>H·ªç v√† t√™n</p>
                                <input type="text" name="Name" value="@(ViewBag.UserData?.FullName ?? "")" placeholder="Nh·∫≠p h·ªç v√† t√™n">
                            </div>
                            <div class="TextBox">
                                <p>Email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i</p>
                                <input type="text" name="Email" value="@(ViewBag.UserData?.Email ?? "")" placeholder="Nh·∫≠p email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i">
                            </div>
                            <div class="TextBox">
                                <p>M·∫≠t Kh·∫©u Hi·ªán T·∫°i</p>
                                <input type="password" name="CurrentPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
                            </div>
                            <div class="TextBox">
                                <p>M·∫≠t kh·∫©u m·ªõi</p>
                                <input type="password" name="NewPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
                            </div>
                            <div class="TextBox">
                                <p>Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</p>
                                <input type="password" name="ConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                            </div>
                            <button style="display: block; margin: 0 auto;" class="btn-Save btn-update-profile">L∆∞u</button>
                        </form>
                </div>
            </div>
        }
        @if (ViewBag.ViewMode == "ChiTiet")
        {
        <div class="playlist-container">
            <a href="/User/Playlist" class="btn btn-outline-light mb-4" title="Quay l·∫°i danh s√°ch ph√°t">Quay l·∫°i</a>
            <h2 class="NameList">Danh S√°ch Ph√°t: @ViewBag.PlaylistName</h2>

            @if (ViewBag.PlaylistSongs != null && ViewBag.PlaylistSongs.Count > 0)
            {
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                    @foreach (var song in ViewBag.PlaylistSongs)
                    {
                        <div class="col">
                            <div class="card h-100 shadow-sm song-card" data-src="@song.FilePath" data-song-id="@song.Id">
                                <img src="@(song.ImageUrl ?? "/images/default-music.jpg")" class="card-img-top" alt="·∫¢nh b√†i h√°t" />
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title" style="color: white">@song.NameSong</h5>
                                    <div class="mt-auto d-flex justify-content-between">
                                        <button class="btn btn-sm btn-outline-danger remove-from-playlist"
                                                data-song-id="@song.Id"
                                                data-playlist-id="@ViewBag.PlaylistId"
                                                title="Xo√° kh·ªèi playlist">
                                            <i class="bi bi-x-lg"></i> Xo√°
                                        </button>

                                        <button class="btn btn-sm btn-outline-primary btn-play-single" title="Ph√°t b√†i n√†y">
                                            <i class="fas fa-play"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <p>üéß Danh s√°ch ph√°t n√†y kh√¥ng c√≥ b√†i h√°t n√†o.</p>
            }
        </div>
        }
    </div>

    <!-- Modal ƒë·ªÉ ch·ªçn ho·∫∑c t·∫°o playlist -->
    <div class="modal fade" id="addToPlaylistModal" tabindex="-1" aria-labelledby="addToPlaylistModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addToPlaylistModalLabel">Th√™m v√†o Playlist</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addToPlaylistForm">
                        <input type="hidden" id="songId" name="songId">
                        <div class="mb-3">
                            <label for="existingPlaylist" class="form-label">Ch·ªçn playlist hi·ªán c√≥:</label>
                            <select class="form-select" id="existingPlaylist" name="playlistId">
                                <option value="">-- Ch·ªçn playlist --</option>
                                @if (ViewBag.Playlists != null)
                                {
                                    foreach (var playlist in ViewBag.Playlists)
                                    {
                                        <option value="@playlist.Id">@playlist.Name</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="newPlaylistName" class="form-label">Ho·∫∑c t·∫°o playlist m·ªõi:</label>
                            <input type="text" class="form-control" id="newPlaylistName" name="newPlaylistName" placeholder="Nh·∫≠p t√™n playlist">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="savePlaylistBtn">L∆∞u</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal ƒë·ªÉ ƒë·ªïi t√™n playlist -->
    <div class="modal fade" id="editPlaylistModal" tabindex="-1" aria-labelledby="editPlaylistLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="editPlaylistLabel">ƒê·ªïi t√™n Playlist</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editPlaylistId" />
                    <input type="text" id="editPlaylistName" class="form-control" placeholder="T√™n m·ªõi">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="saveEditBtn">L∆∞u</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script>
    const imageBox = document.getElementById("imageBox");
    const nextBtn = document.getElementById("nextBtn");
    const prevBtn = document.getElementById("prevBtn");

    nextBtn.addEventListener("click", () => {
        imageBox.scrollLeft += 320; // 300px card + 20px gap
    });

    prevBtn.addEventListener("click", () => {
        imageBox.scrollLeft -= 320;
  });
</script>
</body>